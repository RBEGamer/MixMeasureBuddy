services:

  web:
    image: nginx
    volumes:
      - ./nginx/nginx.conf:/tmp/nginx.conf
      - ./nginx/html:/etc/nginx/html
    environment: 
      - API_SERVER_ADDR=mmb_api:5500  
      - FRONTEND_SERVER_ADDR=mmb_frontend:3000  
    command: /bin/bash -c "envsubst < /tmp/nginx.conf > /etc/nginx/conf.d/default.conf && nginx -g 'daemon off;'" 
    ports:
      - 10443:80 #HOST:CONTAINER
    depends_on:
      - mmb_api
      - mmb_frontend
    links:
      - "mmb_api:mmb_api"
      - "mmb_frontend:mmb_frontend"

  mmb_frontend:
    build:
      context: frontend
    environment:
      - FRONTEND_SERVER_ADDR=3000

  mmb_api:
    build:
      context: api
    stop_signal: SIGINT
    environment:
      - API_SERVER_ADDR=5500
      - FRONTEND_SERVER_ADDR=3000
      - DATABASE_CONNECTION_STRING=mongodb://mmb_mongo:27017
    volumes:
      - ./api:/src
    depends_on:
      -  mmb_mongo  
    links:
      - "mmb_mongo:mmb_mongo"

  mmb_mongo:
    image: mongo
    #ports:
    #  - 27018:27017 # host:container
#    volumes:
#      - './mongo/db:/data/db'
